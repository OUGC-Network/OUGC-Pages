<?xml version="1.0" encoding="UTF-8"?>
<!-- MyBB PluginLibrary XML-Export :: 2024-07-16T04:20:40+00:00 -->
<array>
    <element>
        <key>name</key>
        <value>Latest Threads</value>
    </element>
    <element>
        <key>description</key>
        <value>Show a list of latest threads</value>
    </element>
    <element>
        <key>url</key>
        <value>latest-threads</value>
    </element>
    <element>
        <key>allowedGroups</key>
        <value>-1</value>
    </element>
    <element>
        <key>php</key>
        <value>1</value>
    </element>
    <element>
        <key>wol</key>
        <value>0</value>
    </element>
    <element>
        <key>visible</key>
        <value>1</value>
    </element>
    <element>
        <key>wrapper</key>
        <value>0</value>
    </element>
    <element>
        <key>init</key>
        <value>1</value>
    </element>
    <element>
        <key>template</key>
        <value><![CDATA[<?php

const LATEST_THREADS_OPTIONS = [
    'threadsLimit' => 10,
    'forumIDs' => -1, // comma separated, -1 for all
];

// We initialize a session otherwise get_unviewable_forums() returns all forums
require_once MYBB_ROOT . 'inc/class_session.php';

$session = new session;

$session->init();

require_once MYBB_ROOT . 'inc/class_parser.php';

$parser = new postParser;

global $db, $templates;

$templates->cache('ougcpages_banned_ban, ougcpages_banned_nobanned, ougcpages_banned');

isset($templates->cache['ougcPages_latestThreadsRow']) || $templates->cache['ougcPages_latestThreadsRow'] = '<tr>
<td class="{$alternativeTrow}">{$threadSubject}</td>
<td class="{$alternativeTrow}" align="center">{$threadDate}</td>
</tr>';
isset($templates->cache['ougcPages_latestThreadsEmpty']) || $templates->cache['ougcPages_latestThreadsEmpty'] = '<tr>
	<td class="trow1" align="center" colspan="2">There are no threads to display.</td>
</tr>';
isset($templates->cache['ougcPages_latestThreads']) || $templates->cache['ougcPages_latestThreads'] = '<table border="0" cellspacing="" cellpadding="" class="tborder">
    <tr>
        <td class="thead" colspan="2">
        <strong>{$lang->ban_banned}</strong></td>
    </tr>
    <tr>
        <td class="tcat"><span class="smalltext"><strong>Subject</strong></span></td>
        <td class="tcat" align="center" width="30%"><span class="smalltext"><strong>Date</strong></span></td>
    </tr>
    {$threadList}
</table>';

$whereClauses = [];

if ($unviewableforums = get_unviewable_forums(true)) {
    $whereClauses[] = "t.fid NOT IN({$unviewableforums})";
}

if ($inactiveforums = get_inactive_forums()) {
    $whereClauses[] = "t.fid NOT IN({$inactiveforums})";
}

if (!empty(LATEST_THREADS_OPTIONS['forumIDs']) && (int)LATEST_THREADS_OPTIONS['forumIDs'] !== -1) {
    $pollForumIDs = implode("','", array_map('intval', explode(',', LATEST_THREADS_OPTIONS['forumIDs'])));

    $whereClauses[] = "t.fid IN ('{$pollForumIDs}')";
}

$queryOptions = ['limit' => LATEST_THREADS_OPTIONS['threadsLimit'], 'order_by' => 't.dateline', 'order_dir' => 'desc'];

$queryTables = [
    'threads t',
    "{$db->table_prefix}posts p ON (p.pid=t.firstpost)",
];

$queryFields = ['t.subject', 't.dateline'];

$dbQuery = $db->simple_select(
    implode(' LEFT JOIN ', $queryTables),
    implode(',', $queryFields),
    implode(' AND ', $whereClauses),
    $queryOptions
);

$alternativeTrow = alt_trow(true);

$threadList = '';

while ($threadData = $db->fetch_array($dbQuery)) {
    $threadSubject = htmlspecialchars_uni(
        $parser->parse_badwords($threadData['subject'])
    );

    $threadDate = my_date('relative', $threadData['dateline']);

    $threadList .= eval($templates->render('ougcPages_latestThreadsRow', true, false));

    $alternativeTrow = alt_trow();
}

if (!$threadList) {
    $threadList = eval($templates->render('ougcPages_latestThreadsEmpty', true, false));
}

$threadList = eval($templates->render('ougcPages_latestThreads', true, false));

echo $threadList;

exit;]]></value>
    </element>
    <element>
        <key>versioncode</key>
        <value type="INT">1833</value>
    </element>
</array>
        <!-- End of file. -->
